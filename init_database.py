#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
–°–æ–∑–¥–∞–µ—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–æ–¥–µ–ª–µ–π, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤ db.Model.
"""

import os
import sys
import logging
from dotenv import load_dotenv

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ---
# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ src, —á—Ç–æ–±—ã Python –º–æ–≥ –Ω–∞–π—Ç–∏ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
sys.path.append(os.path.join(os.path.dirname(__file__), 'src'))
load_dotenv()
logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')
logger = logging.getLogger(__name__)


def main():
    """
    –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è.
    –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, —Å–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –≤—ã–∑—ã–≤–∞–µ—Ç db.create_all().
    """
    print("üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...")
    print("=" * 60)

    try:
        # --- –ö–õ–Æ–ß–ï–í–û–ô –ú–û–ú–ï–ù–¢ ---
        # –ú—ã –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –≤–∞—à–µ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –æ–±—ä–µ–∫—Ç `db` –∏–∑ –Ω–µ–≥–æ.
        # –ó–∞–º–µ–Ω–∏—Ç–µ 'application' –Ω–∞ –∏–º—è —Ñ–∞–π–ª–∞, –≥–¥–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è `app = Flask(__name__)`.
        # –ó–∞–º–µ–Ω–∏—Ç–µ 'db' –Ω–∞ –∏–º—è –≤–∞—à–µ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π SQLAlchemy, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–Ω–∞—á–µ.
        from main import app, db

        # Flask-SQLAlchemy —Ç—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
        # –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å –≤–Ω—É—Ç—Ä–∏ "–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è".
        with app.app_context():
            logger.info("–°–æ–∑–¥–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–æ–¥–µ–ª–µ–π Flask-SQLAlchemy...")
            
            # –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ - –∞–Ω–∞–ª–æ–≥ Base.metadata.create_all(engine)
            # –û–Ω–∞ –Ω–∞–π–¥–µ—Ç –≤—Å–µ –∫–ª–∞—Å—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è –æ—Ç db.Model, –∏ —Å–æ–∑–¥–∞—Å—Ç –¥–ª—è –Ω–∏—Ö —Ç–∞–±–ª–∏—Ü—ã.
            db.create_all()
            
            logger.info("‚úÖ –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω—ã!")

        print("‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!")

    except ImportError as e:
        logger.error(f"‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –û–®–ò–ë–ö–ê –ò–ú–ü–û–†–¢–ê: –ù–µ —É–¥–∞–ª–æ—Å—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å 'app' –∏–ª–∏ 'db'.")
        logger.error(f"   –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ —Ñ–∞–π–ª–µ 'src/application.py' –µ—Å—Ç—å 'app = Flask(...)' –∏ 'db = SQLAlchemy(app)'.")
        logger.error(f"   –¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏: {e}", exc_info=True)
        sys.exit(1)
    except Exception as e:
        logger.error(f"‚ùå –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —Å –æ—à–∏–±–∫–∞–º–∏! –û—à–∏–±–∫–∞: {e}", exc_info=True)
        sys.exit(1)


if __name__ == "__main__":
    main()
